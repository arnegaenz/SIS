<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <script>try{var t=localStorage.getItem('sis-theme');if(t)document.documentElement.setAttribute('data-theme',t)}catch(e){}</script>
  <title>Merchant Health Heatmap (90-day mock)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <link rel="stylesheet" href="./sis-shared.css?v=navfix" />
  <link rel="stylesheet" href="./assets/css/sis.css">
  <script src="./assets/js/passcode-gate.js"></script>
  <script defer src="./assets/js/sis.js"></script>
  <script src="./assets/js/config.js"></script>
  <script defer src="./assets/js/nav.js"></script>
  <style>
    :root {
      --cell: 12px;           /* size of each day square */
      --rows: 12;             /* how many merchants to show in mock */
      --days: 90;             /* number of days across */
      --bg: #0b0f14; --fg: #d9e1ee; --muted:#7b8a9a;
      --ok:#24d07a; --warn:#f4c430; --bad:#ff5c5c; --unk:#2a3a4a;
    }
    html,body{margin:0;background:var(--bg);color:var(--fg);font:14px/1.4 ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial;}
    .wrap{padding:18px 20px 30px;max-width:1200px;margin:auto;overflow-x:auto;-webkit-overflow-scrolling:touch;}
    h1{font-size:18px;margin:0 0 8px}
    .sub{color:var(--muted);margin-bottom:14px}
    .legend{display:flex;gap:10px;align-items:center;margin:10px 0 18px}
    .dot{width:12px;height:12px;border-radius:2px;background:var(--unk)}
    .ok{background:var(--ok)} .warn{background:var(--warn)} .bad{background:var(--bad)} .unk{background:var(--unk)}
    .grid{display:grid;grid-template-columns: 240px repeat(var(--days), var(--cell)); gap:0}
    .hdr{position:sticky;top:0;background:linear-gradient(to bottom, #0b0f14, #0b0f14);z-index:2}
    .hdr .label{color:var(--muted);font-size:12px;padding:6px 8px}
    .hdr .days{display:grid;grid-template-columns:repeat(var(--days), var(--cell));}
    .hdr .day{width:var(--cell);height:20px;color:#5e6a78;font-size:10px;display:flex;align-items:center;justify-content:center}
    .row{display:contents}
    .merchant{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding:6px 8px;border-bottom:1px solid rgba(255,255,255,0.05)}
    .cells{display:grid;grid-template-columns:repeat(var(--days), var(--cell));}
    .c{width:var(--cell);height:var(--cell)} /* no gap -> touching heatmap */
    .c.ok{background:var(--ok)}
    .c.warn{background:var(--warn)}
    .c.bad{background:var(--bad)}
    .c.unk{background:var(--unk)}
    .footer{color:var(--muted);font-size:12px;margin-top:14px}
    .stickyLeft{position:sticky;left:0;background:#0b0f14;z-index:1}
  </style>
  <script defer src="./assets/js/card-tooltips.js"></script>
</head>
<body>
  <header class="sis-header">
    <div class="sis-topbar">
      <div class="sis-title">Strivve Insights Service</div>
      <nav class="sis-nav" data-current></nav>
    </div>
    <div class="sis-page-header">
      <h1 class="sis-page-title">Merchant Health Heatmap (90-day mock)</h1>
      <div class="sis-page-header-row">
        <p class="sis-page-subtitle">Squares touch (no gutters). One row per merchant; one column per day. Colors reflect site health only.</p>
        <button class="theme-toggle" type="button" aria-pressed="false">Light mode</button>
      </div>
    </div>
  </header>
  <div class="wrap">
    <div class="sub"><b>Tip:</b> Toggle dark/light mode in the header to preview theme contrast.</div>

    <div class="legend">
      <span class="dot ok"></span><span>Healthy</span>
      <span class="dot warn"></span><span>Degraded</span>
      <span class="dot bad"></span><span>Outage</span>
      <span class="dot unk"></span><span>No traffic</span>
    </div>

    <!-- Header -->
    <div class="grid hdr">
      <div class="label stickyLeft">Merchant ▸</div>
      <div class="days">
        <!-- Render every 5th day tick to keep tidy -->
      </div>
    </div>

    <!-- Rows render here -->
    <div id="rows" class="grid"></div>

    <div class="footer">Mock data generator: success rate per day is randomized around each merchant’s baseline. Replace generator with real SIS data when ready.</div>
  </div>

  <script>
    // ==== Mock data generator (replace with real daily rollups) ====
    const DAYS = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--days')) || 90;
    const MERCHANTS = [
      "amazon.com","apple.com","walmart.com","netflix.com","uber.com","starbucks.com",
      "target.com","venmo.com","disneyplus.com","siriusxm.com","microsoft.com","ebay.com"
    ];
    // Baseline health probabilities per merchant (0..1). Tweak to see variety.
    const BASE = {
      "amazon.com":0.95,"apple.com":0.90,"walmart.com":0.78,"netflix.com":0.82,"uber.com":0.55,"starbucks.com":0.88,
      "target.com":0.85,"venmo.com":0.62,"disneyplus.com":0.65,"siriusxm.com":0.40,"microsoft.com":0.30,"ebay.com":0.48
    };
    // Return a class for the daily health: ok / warn / bad / unk
    function classify(p){ // p = success rate 0..1; null => no traffic
      if (p == null) return "unk";
      if (p >= 0.85) return "ok";
      if (p >= 0.55) return "warn";
      return "bad";
    }
    // Make a 90-day array for one merchant with slight drift + random no-traffic pockets
    function genSeries(merchant){
      const base = BASE[merchant] ?? 0.6;
      const arr = [];
      let drift = (Math.random()*0.14 - 0.07); // one-off merchant drift
      for (let i=0;i<DAYS;i++){
        // 10% chance of no traffic on a given day
        if (Math.random() < 0.10){ arr.push(null); continue; }
        // daily jitter
        const jitter = (Math.random()*0.20 - 0.10);
        const p = Math.max(0, Math.min(1, base + drift + jitter));
        arr.push(p);
      }
      return arr;
    }
    // Build header ticks
    (function renderHeader(){
      const daysEl = document.querySelector(".hdr .days");
      for (let i=1;i<=DAYS;i++){
        const d = document.createElement("div");
        d.className = "day";
        d.textContent = (i%5===0)? String(i).padStart(2," "): "";
        daysEl.appendChild(d);
      }
    })();
    // Render rows
    (function renderRows(){
      const rows = document.getElementById("rows");
      MERCHANTS.forEach(name=>{
        const series = genSeries(name);

        const label = document.createElement("div");
        label.className = "merchant stickyLeft";
        label.textContent = name;

        const cells = document.createElement("div");
        cells.className = "cells";
        series.forEach(p=>{
          const c = document.createElement("div");
          c.className = "c " + classify(p);
          c.title = (p==null? "no traffic" : `health ${(p*100).toFixed(0)}%`);
          cells.appendChild(c);
        });

        // Row is "display:contents" via .grid so we append both parts in order
        rows.appendChild(label);
        rows.appendChild(cells);
      });
    })();
  </script>
  <script src="./theme-toggle.js"></script>
</body>
</html>
