<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>UX Success Paths • Strivve Insights</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="./sis-shared.css?v=navfix" />
  <link rel="stylesheet" href="./assets/css/sis.css">
  <link rel="stylesheet" href="./assets/css/mobile.css">
  <link rel="stylesheet" href="./assets/css/filters.css">
  <script src="./assets/js/passcode-gate.js"></script>
  <script defer src="./assets/js/sis.js"></script>
  <script defer src="./assets/js/filters.js?v=shared"></script>
  <script src="./assets/js/config.js"></script>
  <script defer src="./assets/js/nav.js"></script>
  <script defer src="./assets/js/ux-paths.js"></script>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      background: radial-gradient(circle at top, rgba(37,99,235,.09), transparent 42%) var(--bg);
      color: var(--text);
      font-family: "Inter", "Segoe UI", ui-sans-serif, system-ui, -apple-system, Roboto, "Helvetica Neue", Arial;
      --sis-panel-bg: var(--panel);
    }

    .path-metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }

    .metric-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      box-shadow: var(--shadow);
    }

    .metric-value {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 4px;
    }

    .metric-label {
      font-size: 0.75rem;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      font-weight: 600;
    }

    .metric-detail {
      font-size: 0.8rem;
      color: var(--muted);
      margin-top: 4px;
    }

    .sis-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
    }

    .sis-table th {
      text-align: left;
      padding: 12px;
      background: var(--bg-subtle, rgba(0,0,0,0.03));
      color: var(--text);
      font-weight: 600;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      border-bottom: 2px solid var(--border);
    }

    .sis-table td {
      padding: 12px;
      border-bottom: 1px solid var(--border);
      color: var(--text);
      font-size: 0.9rem;
    }

    .sis-table tbody tr:hover {
      background: var(--bg-subtle, rgba(0,0,0,0.02));
    }

    .sis-table td strong {
      color: var(--accent);
      font-weight: 700;
    }

    /* Highlight the row that owns an expanded details panel */
    .sis-table tbody tr[data-ux-expanded="1"] {
      background: rgba(37,99,235,0.10);
    }
    .sis-table tbody tr[data-ux-expanded="1"] td:first-child {
      box-shadow: inset 3px 0 0 rgba(37,99,235,0.85);
    }
    .sis-table tbody tr[data-ux-detail-row="1"] td {
      padding-top: 0;
    }
    /* Chevron indicator on expandable links */
    button[data-ux-open-session]::before,
    button[data-ux-open-pattern]::before,
    button[data-ux-open-retry]::before {
      content: "▸ ";
      color: var(--muted);
      font-weight: 900;
    }
    .sis-table tbody tr[data-ux-expanded="1"] button[data-ux-open-session]::before,
    .sis-table tbody tr[data-ux-expanded="1"] button[data-ux-open-pattern]::before,
    .sis-table tbody tr[data-ux-expanded="1"] button[data-ux-open-retry]::before {
      content: "▾ ";
      color: var(--accent);
    }

    /* ===== Session Details (match troubleshoot.html) ===== */
    .session-list { display: flex; flex-direction: column; gap: 12px; margin-top: 10px; }
    .session-card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 14px;
      box-shadow: 0 16px 40px rgba(15, 23, 42, 0.10);
    }
    .session-top {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      margin-bottom: 8px;
    }
    .chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: var(--chip-bg);
      color: var(--chip-text);
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 0.78rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }
    .chip.muted { background: var(--panel-light); color: var(--muted); }
    .session-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      color: var(--muted);
      font-size: 0.88rem;
    }
    .session-meta strong { color: var(--text); }
    .clickstream { margin: 10px 0; display: flex; flex-wrap: wrap; gap: 6px; }
    .click-pill {
      background: var(--panel-light);
      border: 1px dashed var(--border);
      border-radius: 8px;
      padding: 6px 8px;
      font-size: 0.8rem;
      color: var(--muted);
    }
    .click-pill.has-jobs {
      position: relative;
      padding-right: 6px;
    }
    .job-dot {
      display: inline-block;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      margin-left: 2px;
      vertical-align: middle;
    }
    .job-dot-success {
      background: var(--badge-success, #16a34a);
      box-shadow: 0 0 0 1px rgba(22,163,74,0.3);
    }
    .job-dot-warn {
      background: var(--badge-warn, #f59e0b);
      box-shadow: 0 0 0 1px rgba(245,158,11,0.4);
    }
    .job-dot-fail {
      background: var(--badge-fail, #dc2626);
      box-shadow: 0 0 0 1px rgba(220,38,38,0.3);
    }
    .job-dot-neutral {
      background: var(--muted, #94a3b8);
      box-shadow: 0 0 0 1px rgba(148,163,184,0.3);
    }
    .ux-load-more-btn {
      display: block;
      width: 100%;
      margin-top: 12px;
      padding: 10px 16px;
      background: var(--panel-light);
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--text);
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.15s ease;
    }
    .ux-load-more-btn:hover {
      background: var(--panel);
      border-color: var(--accent);
      color: var(--accent);
    }
    .jobs { display: flex; flex-direction: column; gap: 8px; margin-top: 8px; }
    .job { border: 1px solid var(--border); border-radius: 10px; padding: 10px 12px; background: var(--panel-light); }
    .job-header { display: flex; flex-wrap: wrap; gap: 8px; align-items: center; margin-bottom: 6px; }
    .badge { display: inline-flex; align-items: center; gap: 6px; border-radius: 999px; padding: 4px 9px; font-size: 0.78rem; letter-spacing: 0.02em; }
    .badge.success { background: rgba(22,163,74,0.12); color: var(--badge-success); }
    .badge.fail { background: rgba(220,38,38,0.12); color: var(--badge-fail); }
    .badge.warn { background: rgba(245,158,11,0.15); color: var(--badge-warn); }
    .badge.neutral { background: var(--panel); color: var(--muted); border: 1px solid var(--border); }
    .job-meta { display: flex; flex-wrap: wrap; gap: 10px; font-size: 0.82rem; color: var(--muted); }
    .raw-details { margin-top: 10px; border: 1px solid var(--border); border-radius: 10px; background: var(--panel-light); }
    .raw-details summary { cursor: pointer; padding: 10px 12px; font-weight: 600; color: var(--muted); list-style: none; }
    .raw-details summary::-webkit-details-marker { display: none; }
    .raw-details summary::before { content: "▸"; display: inline-block; margin-right: 6px; transform: translateY(-1px); }
    .raw-details[open] summary::before { content: "▾"; }
    .raw-block {
      padding: 0 12px 12px;
      overflow: auto;
      max-height: 360px;
      font-family: ui-monospace, SFMono-Regular, SFMono, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.85rem;
      color: var(--muted);
      white-space: pre;
    }
    @media (max-width: 720px) { .session-meta { flex-direction: column; } }

    .funnel-header {
      margin-bottom: 8px;
    }

    .form-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: flex-end;
    }

    .form-grid--dates {
      margin-top: 8px;
    }

    .form-field {
      display: flex;
      flex-direction: column;
      gap: 6px;
      min-width: 160px;
      min-height: 54px;
    }

    .form-field label {
      font-size: 0.85rem;
      color: var(--muted);
      letter-spacing: 0.03em;
      text-transform: uppercase;
      padding-left: 2px;
    }

    .form-input,
    .form-select {
      background: var(--input-bg);
      border: 1px solid var(--input-border);
      border-radius: 10px;
      color: var(--text);
      padding: 10px 12px;
      font-size: 0.92rem;
      min-width: 160px;
      height: 42px;
      line-height: 22px;
      box-sizing: border-box;
    }

    .form-input:focus,
    .form-select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(37,99,235,0.2);
    }

    .form-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
      margin-top: 0;
    }

    .form-button {
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 10px;
      padding: 10px 16px;
      font-size: 0.92rem;
      font-weight: 600;
      cursor: pointer;
      height: 42px;
      transition: all 0.15s ease;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .form-button:hover {
      filter: brightness(1.1);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
      transform: translateY(-1px);
    }

    .form-button:active {
      transform: translateY(0);
      box-shadow: 0 1px 2px rgba(0,0,0,0.1);
      filter: brightness(0.95);
    }

    .form-button.secondary {
      background: var(--panel-light);
      color: var(--text);
      border: 1px solid var(--input-border);
    }

    /* ===== JSON Explorer Modal ===== */
    .ux-modal[hidden] { display: none; }
    .ux-modal {
      position: fixed;
      inset: 0;
      z-index: 1000;
      display: grid;
      place-items: center;
      padding: 18px;
      background: rgba(0,0,0,0.55);
      backdrop-filter: blur(3px);
    }
    body.ux-modal-open { overflow: hidden; }
    .ux-modal-card {
      width: min(1100px, 96vw);
      max-height: min(86vh, 900px);
      overflow: hidden;
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: 0 22px 70px rgba(0,0,0,0.35);
      display: flex;
      flex-direction: column;
    }
    .ux-modal-top {
      display: flex;
      gap: 10px;
      align-items: center;
      justify-content: space-between;
      padding: 12px 14px;
      border-bottom: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(37,99,235,0.08), transparent);
    }
    .ux-modal-title {
      display: flex;
      flex-direction: column;
      gap: 2px;
      min-width: 0;
    }
    .ux-modal-title h3 {
      margin: 0;
      font-size: 14px;
      letter-spacing: 0.2px;
    }
    .ux-modal-title .muted { color: var(--muted); font-size: 12px; }
    .ux-modal-actions { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
    .ux-pill {
      border: 1px solid var(--border);
      background: var(--panel-light);
      color: var(--text);
      border-radius: 999px;
      padding: 8px 12px;
      font-size: 12px;
      font-weight: 650;
      cursor: pointer;
    }
    .ux-pill.primary { background: linear-gradient(120deg, var(--accent), var(--accent-2)); color: #f8fafc; border: 0; }
    .ux-pill.ghost { background: transparent; }
    .ux-modal-body {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
      padding: 12px 14px;
      overflow: auto;
    }
    .ux-tabs { display:flex; gap: 8px; flex-wrap: wrap; }
    .ux-tab {
      border: 1px solid var(--border);
      background: transparent;
      color: var(--muted);
      border-radius: 999px;
      padding: 8px 12px;
      font-size: 12px;
      font-weight: 650;
      cursor: pointer;
    }
    .ux-tab[aria-selected="true"]{
      color: var(--text);
      border-color: rgba(37,99,235,0.35);
      background: rgba(37,99,235,0.10);
    }
    .ux-json-pre {
      margin: 0;
      padding: 12px;
      background: rgba(2,6,23,0.55);
      border: 1px solid rgba(148,163,184,0.18);
      border-radius: 12px;
      color: #e6edf3;
      font: 12px/1.5 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      white-space: pre;
      overflow: auto;
      max-height: 60vh;
    }
    .ux-link {
      background: transparent;
      border: 0;
      padding: 0;
      margin: 0;
      color: var(--accent);
      font-weight: 700;
      cursor: pointer;
      text-decoration: underline;
      text-underline-offset: 2px;
    }
  </style>
</head>
<body>
  <div id="sis-header"></div>

  <div class="sis-content">
    <main class="sis-main">

      <!-- Filter Panel -->
      <section class="sis-panel">
        <div id="filter-bar"></div>
        <div class="funnel-header">
          <div class="form-grid form-grid--dates">
            <div class="form-field">
              <label for="datePreset">Range preset</label>
              <select id="datePreset" class="form-select">
                <option value="last7" selected>Last 7 days</option>
                <option value="last14">Last 14 days</option>
                <option value="last30">Last 30 days</option>
                <option value="last60">Last 60 days</option>
                <option value="last90">Last 90 days</option>
                <option value="ytd">Year to date</option>
                <option value="">Custom</option>
              </select>
            </div>
            <div class="form-field">
              <label for="startDate">Start date</label>
              <input id="startDate" type="date" class="form-input" />
            </div>
            <div class="form-field">
              <label for="endDate">End date</label>
              <input id="endDate" type="date" class="form-input" />
            </div>
            <div class="form-field">
              <label for="applyBtn">Actions</label>
              <div class="form-actions">
                <button id="applyBtn" class="form-button">Apply filters</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Success Overview Metrics -->
      <section class="sis-panel" id="uxSuccessOverview">
        <h2 class="sis-panel-title">Success Overview</h2>
        <p class="sis-panel-subtitle">Showing only sessions with successful placements</p>
        <div class="path-metrics-grid">
          <div class="metric-card">
            <div class="metric-value" id="successfulSessions">-</div>
            <div class="metric-label">Successful Sessions</div>
            <div class="metric-detail" id="totalSessionsDetail">-</div>
          </div>
          <div class="metric-card">
            <div class="metric-value" id="avgJobsPerSession">-</div>
            <div class="metric-label">Avg Jobs per Session</div>
          </div>
          <div class="metric-card">
            <div class="metric-value" id="highPerformerCount">-</div>
            <div class="metric-label">High Performers (3+ jobs)</div>
          </div>
        </div>
      </section>

      <!-- Successful Path Patterns -->
      <section class="sis-panel" id="uxPathPatterns">
        <h2 class="sis-panel-title">Successful Path Patterns</h2>
        <p class="sis-panel-subtitle">Journey patterns that lead to successful placements</p>
        <div class="table-scroll">
          <table class="sis-table" id="pathPatternsTable">
            <thead>
              <tr>
                <th>Path Pattern</th>
                <th>Sessions</th>
                <th>Avg Successful Jobs</th>
                <th>Avg Duration</th>
                <th>% of Successful Sessions</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td colspan="5" style="text-align: center; padding: 20px; color: var(--muted);">
                  Loading data...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- High Performer Sessions -->
      <section class="sis-panel" id="uxHighPerformers">
        <h2 class="sis-panel-title">High Performer Sessions (3+ Successful Jobs)</h2>
        <p class="sis-panel-subtitle">Sessions with exceptional success rates</p>
        <div class="table-scroll">
          <table class="sis-table" id="highPerformersTable">
            <thead>
              <tr>
                <th>Session ID</th>
                <th>Successful Jobs</th>
                <th>Duration</th>
                <th>Path Pattern</th>
                <th>Pages Visited</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td colspan="5" style="text-align: center; padding: 20px; color: var(--muted);">
                  Loading data...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Time Analysis for Successful Sessions -->
      <section class="sis-panel" id="uxTimeByPage">
        <h2 class="sis-panel-title">Time Spent by Page (Successful Sessions Only)</h2>
        <p class="sis-panel-subtitle">How long successful users spend at each step</p>
        <div class="table-scroll">
          <table class="sis-table" id="timeAnalysisTable">
            <thead>
              <tr>
                <th>Page</th>
                <th>Avg Time</th>
                <th>Median Time</th>
                <th>90th Percentile</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td colspan="4" style="text-align: center; padding: 20px; color: var(--muted);">
                  Loading data...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Retry Patterns in Successful Sessions -->
      <section class="sis-panel" id="uxRetryPatterns">
        <h2 class="sis-panel-title">Retry Patterns (Successful Sessions)</h2>
        <p class="sis-panel-subtitle">How successful users navigate when they backtrack</p>
        <div class="table-scroll">
          <table class="sis-table" id="retryPatternsTable">
            <thead>
              <tr>
                <th>From Page</th>
                <th>To Page</th>
                <th>Count</th>
                <th>Avg Jobs After Retry</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td colspan="4" style="text-align: center; padding: 20px; color: var(--muted);">
                  Loading data...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

    </main>
  </div>

  <!-- JSON Explorer Modal (lazy rendered) -->
  <div id="uxJsonModal" class="ux-modal" hidden aria-hidden="true">
    <div class="ux-modal-card" role="dialog" aria-modal="true" aria-labelledby="uxJsonTitle">
      <div class="ux-modal-top">
        <div class="ux-modal-title">
          <h3 id="uxJsonTitle">Session JSON Explorer</h3>
          <div class="muted" id="uxJsonSubtitle">Select a tab to load JSON.</div>
        </div>
        <div class="ux-modal-actions">
          <button type="button" class="ux-pill ghost" id="uxJsonClose">Close</button>
          <button type="button" class="ux-pill" id="uxJsonCopy">Copy JSON</button>
          <button type="button" class="ux-pill" id="uxJsonDownload">Download</button>
        </div>
      </div>
      <div class="ux-modal-body">
        <div class="ux-tabs" role="tablist" aria-label="JSON Tabs">
          <button type="button" class="ux-tab" role="tab" data-tab="session" aria-selected="true">Session</button>
          <button type="button" class="ux-tab" role="tab" data-tab="jobs" aria-selected="false">Jobs</button>
          <button type="button" class="ux-tab" role="tab" data-tab="clickstream" aria-selected="false">Clickstream</button>
          <button type="button" class="ux-tab" role="tab" data-tab="placements" aria-selected="false">Placements</button>
        </div>
        <pre class="ux-json-pre" id="uxJsonPre">Select a tab to load JSON…</pre>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function(){
      if (window.renderHeaderNav && !window.__sisHeaderNav_uxpaths) {
        window.__sisHeaderNav_uxpaths = true;
        window.renderHeaderNav({
          currentId: "ux-paths",
          title: "UX Success Paths",
          subtitle: "Track user journey patterns and identify successful paths through the card placement flow."
        });
      }
    });
  </script>
</body>
</html>
